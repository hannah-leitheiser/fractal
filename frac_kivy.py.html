<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>~/fractals/frac_kivy.py.html</title>
<meta name="Generator" content="Vim/7.4">
<meta name="plugin-version" content="vim7.4_v2">
<meta name="syntax" content="python">
<meta name="settings" content="use_css,pre_wrap,no_foldcolumn,prevent_copy=">
<meta name="colorscheme" content="none">
<style type="text/css">
<!--
pre { white-space: pre-wrap; font-family: monospace; color: #000000; background-color: #ffffff; }
body { font-family: monospace; color: #000000; background-color: #ffffff; }
* { font-size: 1em; }
.Comment { color: #0000ff; }
.Statement { color: #a52a2a; font-weight: bold; }
.PreProc { color: #800080; }
.Constant { color: #ff00ff; }
.Identifier { color: #008b8b; }
-->
</style>

<script type='text/javascript'>
<!--

-->
</script>
</head>
<body>
<pre id='vimCodeElement'>
<span class="PreProc">from</span> kivy.app <span class="PreProc">import</span> App
<span class="PreProc">from</span> kivy.uix.widget <span class="PreProc">import</span> Widget
<span class="PreProc">from</span> kivy.graphics <span class="PreProc">import</span> Color, Ellipse, Rectangle

<span class="PreProc">from</span> kivy.uix.boxlayout <span class="PreProc">import</span> BoxLayout
<span class="PreProc">from</span> kivy.uix.floatlayout <span class="PreProc">import</span> FloatLayout
<span class="PreProc">from</span> kivy.uix.image <span class="PreProc">import</span> AsyncImage
<span class="PreProc">from</span> array <span class="PreProc">import</span> array
<span class="PreProc">from</span> kivy.graphics.texture <span class="PreProc">import</span> Texture

<span class="Statement">def</span> <span class="Identifier">mand</span>(x, y):
	c = <span class="Identifier">complex</span>(x, y)
	z = <span class="Constant">0</span>
	<span class="Statement">for</span> i <span class="Statement">in</span> <span class="Identifier">range</span>(<span class="Constant">32</span>):
		z = z**<span class="Constant">2</span> + c
		<span class="Statement">if</span> z.imag ** <span class="Constant">2</span> + z.real ** <span class="Constant">2</span> &gt; <span class="Constant">4</span>:
			<span class="Statement">return</span> i
	<span class="Statement">return</span> <span class="Constant">0</span>


<span class="Statement">class</span> <span class="Identifier">MyPaintWidget</span>(Widget):


    <span class="Statement">def</span> <span class="Identifier">__init__</span>(self, **kwargs):
        <span class="Comment"># make sure we aren't overriding any important functionality</span>
        <span class="Identifier">super</span>(MyPaintWidget, self).__init__(**kwargs)
        self.offsetx = <span class="Constant">0</span>
        self.offsety = <span class="Constant">0</span>
        self.zoom=<span class="Constant">0.35</span>
        self.bind(pos=self.update)
        self.bind(size=self.update)
        self.movable = <span class="Identifier">True</span>
        self.update()


    <span class="Statement">def</span> <span class="Identifier">update</span>(self, *args):
        <span class="Statement">with</span> self.canvas:
           self.texture = Texture.create(size=self.size)
           buf = []
           <span class="Statement">for</span> y <span class="Statement">in</span> <span class="Identifier">range</span>(self.height):
              <span class="Statement">for</span> x <span class="Statement">in</span> <span class="Identifier">range</span>(self.width):
                 cordx = (x - self.width/<span class="Constant">2</span> - self.offsetx) / (self.height*self.zoom)
                 cordy = (y - self.height/<span class="Constant">2</span> - self.offsety) / (self.height*self.zoom)
                 buf.append( <span class="Identifier">int</span>(mand(cordx, cordy)*<span class="Constant">8</span>) )
                 buf.append(<span class="Constant">0</span>);
                 buf.append(<span class="Constant">0</span>);
           arr= array(<span class="Constant">'</span><span class="Constant">B</span><span class="Constant">'</span>, buf)
           self.texture.blit_buffer(arr, colorfmt=<span class="Constant">'</span><span class="Constant">rgb</span><span class="Constant">'</span>, bufferfmt=<span class="Constant">'</span><span class="Constant">ubyte</span><span class="Constant">'</span>)
           Rectangle(texture=self.texture, pos=self.pos, size=self.size)
           self.movable = <span class="Identifier">True</span>

    <span class="Statement">def</span> <span class="Identifier">on_touch_down</span>(self, touch):
        <span class="Statement">if</span> self.collide_point(*touch.pos):
            <span class="Statement">if</span> touch.is_double_tap <span class="Statement">and</span> self.movable:
                self.zoom=self.zoom*<span class="Constant">2.0</span>
                self.offsetx -= (touch.ox - self.width/<span class="Constant">2</span>)
                self.offsety -= (touch.oy - self.height/<span class="Constant">2</span>)
                self.offsetx*=<span class="Constant">2.0</span>
                self.offsety*=<span class="Constant">2.0</span>
                <span class="Comment">#with self.canvas:</span>
                <span class="Comment">#    Rectangle(texture=self.texture, pos=( (self.width/2-touch.ox)-(self.width*0.5), (self.height/2-touch.oy)-(self.height*0.5)), size=(self.width*1.5,self.height*1.5))</span>
                self.movable = <span class="Identifier">False</span>
                self.update()

    <span class="Statement">def</span> <span class="Identifier">on_touch_move</span>(self, touch):
        <span class="Statement">if</span> self.movable:
            <span class="Statement">with</span> self.canvas:
                Rectangle(texture=self.texture, pos=( (touch.x-touch.ox), (touch.y-touch.oy)), size=self.size)
    <span class="Statement">def</span> <span class="Identifier">on_touch_up</span>(self, touch):
        <span class="Statement">if</span> self.movable:
            self.movable = <span class="Identifier">False</span>
            self.offsetx += (touch.x-touch.ox)
            self.offsety += (touch.y-touch.oy)
            self.update()



<span class="Statement">class</span> <span class="Identifier">MyPaintApp</span>(App):

    <span class="Statement">def</span> <span class="Identifier">build</span>(self):
        <span class="Statement">return</span> MyPaintWidget()


<span class="Statement">if</span> __name__ == <span class="Constant">'</span><span class="Constant">__main__</span><span class="Constant">'</span>:
    MyPaintApp().run()



</pre>
</body>
</html>
<!-- vim: set foldmethod=manual : -->
